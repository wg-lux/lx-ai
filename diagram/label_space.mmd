flowchart TD

    A[Load Raw Annotations]
    A1[Example: Frame101 polyp=True blood=False]
    A -.-> A1

    A --> B[Load LabelSet.labels]
    B1[Example: polyp blood wound]
    B -.-> B1

    B --> C[Filter by LabelSet Version]
    C1[Keep version=2 -> polyp wound]
    C -.-> C1

    C --> D[Count Positive Samples Per Label]
    D1[polyp=1 wound=1]
    D -.-> D1

    D --> |Drop Labels with Zero Positives|F[Determine Final Label Order]
    F1[polyp -> column 0]
    F -.-> F1

    F --> |Initialize Vector with None|H[Fill Vector from Annotations]
    H1["polyp=True -> [1 None]"]
    H -.-> H1

    H --> I{treat_unlabeled_as_negative}

    I -->|True| J[Convert None to 0]
    J1["Vector=[1 0] Mask=[1 1]"]
    J -.-> J1

    I -->|False| K[Keep None]
    K1["Vector=[1 None] Mask=[1 0]"]
    K -.-> K1

    J --> L[Final label_vectors and masks]
    K --> L

    L --> M[Dataset Ready for Bucket Split]

    %% --- Styling ---
    classDef example stroke-dasharray: 5 5,stroke:#666,fill:#f9f9f9;
    class A1,B1,C1,D1,E1,F1,G1,H1,J1,K1 example;